<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>大事件-文章</title>
  <link rel="stylesheet" type="text/css" href="css/reset.css">
  <link rel="stylesheet" href="css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<body>
  <div class="header">
    <a href="#" class="logo fl"><img src="images/logo.png" alt="logo"></a>
    <div class="search_form fl">
      <input type="text" class="search_txt" placeholder="黑洞照片">
      <button class="search_btn"><i class="fa fa-search"></i></button>
    </div>
    <div class="link_info fr">
      <a href="#"><i class="fa fa-angle-right"></i>&nbsp;&nbsp;网站地图</a><br>
      <a href="#"><i class="fa fa-angle-right"></i>&nbsp;&nbsp;招聘信息</a>
    </div>
  </div>

  <div class="menu_con">
    <div class="menu">
      <div class="menu_collapse fl">
        <a href="javascript:;" class="level_one"><i class="fa fa-list-ul"></i>全部分类</a>
        <ul class="level_two">
          <li class="up"></li>
          <li><a href="#">最 新</a></li>
          <li><a href="#">科 技</a></li>
          <li><a href="#">股 市</a></li>
          <li><a href="#">商 品</a></li>
          <li><a href="#">外 汇</a></li>
          <li><a href="#">公 司</a></li>
        </ul>
      </div>
      <ul class="left_menu fl">
        <li><a href="#">最 新</a></li>
        <li><a href="#">科 技</a></li>
        <li><a href="#">股 市</a></li>
        <li><a href="#">商 品</a></li>
        <li><a href="#">外 汇</a></li>
        <li><a href="#">公 司</a></li>
      </ul>
      <ul class="right_menu fr">
        <li><a href="#">科技专题</a></li>
        <li><a href="#">财经专题</a></li>
      </ul>
    </div>
  </div>

  <div class="main_con clearfix">
    <div class="left_con setfr">
      <div id="contentBox"></div>

      <form action="" class="comment_form" id="formData">
        <div class="form_group">
          <label>用户名：</label>
          <input type="text" placeholder="请输入用户名" class="comment_name" name="author" id="author">
        </div>
        <div class="form_group">
          <label>评论内容：</label>
          <textarea placeholder="请发表您的评论" class="comment_input" name="content" id="content"></textarea>
        </div>
        <div class="form_group">
          <input type="submit" value="评 论" class="comment_sub" id="comment_btn">
        </div>
      </form>

      <div id="commentsCountBox"></div>

      <div class="comment_list_con" id="comment_detailBox">

      </div>
    </div>
    <div class="right_con setfl">
      <div class="common_wrap">
        <h3><i class="fa fa-bar-chart"></i> 一周热门排行</h3>
        <ul class="content_list" id="hotlistBox">

        </ul>
      </div>
      <div class="common_wrap">
        <h3><i class="fa fa-commenting-o"></i> 最新评论</h3>
        <ul class="content_list comment_list" id="comment_listBox">

        </ul>
      </div>
      <div class="common_wrap">
        <h3><i class="fa fa-bullseye"></i> 焦点关注</h3>
        <ul class="content_list guanzhu_list" id="guanzhu_listBox">

        </ul>
      </div>
    </div>
  </div>

  <div class="footer clearfix">
    <div class="foot_link">
      <a href="#">关于我们</a>
      <span>|</span>
      <a href="#">联系我们</a>
      <span>|</span>
      <a href="#">招聘人才</a>
      <span>|</span>
      <a href="#">友情链接</a>
    </div>
    <p>CopyRight © 2019 深圳大事件信息技术股份有限公司 All Rights Reserved</p>
    <p>电话：0755-****888 粤ICP备*******8号</p>
  </div>


  <script src="./js/jquery-1.12.4.min.js"></script>
  <script src="./js/template-web.js"></script>

  <!-- 热门排行模板 -->
  <script type="text/html" id="hotlistTpl">
    <li><span class="first">1</span><a href="#">{{data[0].title}}</a></li>
    <li><span class="second">2</span><a href="#">{{data[1].title}}</a></li>
    <li><span class="third">3</span><a href="#">{{data[2].title}}</a></li>
    <li><span>4</span><a href="#">{{data[3].title}}</a></li>
    <li><span>5</span><a href="#">{{data[4].title}}</a></li>
    <li><span>6</span><a href="#">{{data[5].title}}</a></li>
    <li><span>7</span><a href="#">{{data[6].title}}</a></li>
  </script>

  <!-- 最新评论模板 -->
  <script type="text/html" id="comment_listTpl">
    {{each data}}
    <li>
      <span>{{$value.author.substr(0,1)}}</span>
      <b><em>{{$value.author}}</em> {{$value.date}}说:</b>
      <strong>{{$value.intro}}</strong>
    </li>
    {{/each}}
  </script>

  <!-- 关注模板 -->
  <script type="text/html" id="guanzhu_listTpl">
    {{each data}}
    <li><a href="#">{{$value.intro}}</a></li>
    {{/each}}
  </script>

  <!-- 文章详情模板 -->
  <script type="text/html" id="contentTpl">
    <div class="breadcrumb">
      当前位置： <a href="#">首页</a> &gt; <a href="#">科技</a> &gt; 文章详情
    </div>
    <h3 class="article_title">{{data.title}}</h3>
    <div class="article_info">{{data.author}} 发布于 {{data.date}}&nbsp;&nbsp;&nbsp;分类: {{data.category}}&nbsp;&nbsp;&nbsp;阅读:
      ({{data.read}})&nbsp;&nbsp;&nbsp;评论: ({{data.comments}})</div>
    <div class="article_con">

      <p>{{data.content}}</p>

    </div>
    <div class="article_links">
      上一篇： <a href="article.html?id={{data.prev.id}}" data-id="{{data.prev.id}}">{{data.prev.title}}</a><br>
      下一篇： <a href="article.html?id={{data.next.id}}" data-id="{{data.next.id}}">{{data.next.title}}</a>
    </div>
  </script>

  <!-- 文章评论模板 -->
  <script type="text/html" id="comment_detailTpl">
    {{each data}} 
    <div class="comment_detail_list">
      <div class="person_pic fl">{{$value.author.substr(0,1)}}</div>
      <div class="name_time fl"><b>{{$value.author}}</b><span>{{$value.date}}</span></div>
      <div class="comment_text fl">
        {{$value.content}}
      </div>
    </div>
    {{/each}}
  </script>
  <script type="text/html" id="commentsCountTpl">
    <div class="comment_count">
      {{data.length}}条评论
    </div>
  </script>

  <!-- 文章页面的 js 代码  -->
  <script>
    // 根据id获取文章
    var id = getUrlParams('id');
    $.ajax({
      type: 'get',
      url: 'http://localhost:8080/api/v1/index/article',
      data: {
        id: id
      },
      success: function (response) {
        // console.log(response);
        var html = template('contentTpl', response);
        // console.log(html);
        $('#contentBox').html(html);
      }
    })

    // 发表评论
    $('#comment_btn').on('click', function () {
      var formData = $('#formData').serialize();
      var aId = 'articleId=' + id;
      var data = formData.concat('&', aId);
      $.ajax({
        type: 'post',
        url: 'http://localhost:8080/api/v1/index/post_comment',
        data: data,
        success: function (response) {
          // console.log(response);
          location.reload();
        }
      });
      return false;
    })

    // 获取文章评论
    $.ajax({
      type: 'get',
      url: 'http://localhost:8080/api/v1/index/get_comment',
      data: {
        articleId: id
      },
      success: function (response) {
        // console.log(response);
        var html = template('comment_detailTpl', response);
        $('#comment_detailBox').html(html);
        var chtml = template('commentsCountTpl', response);
        $('#commentsCountBox').html(chtml);
      }
    })


    function getUrlParams(name) {
      var paramsAry = location.search.substr(1).split('&');
      for (var i = 0; i < paramsAry.length; i++) {
        var tmp = paramsAry[i].split('=');
        if (tmp[0] == name) {
          return tmp[1];
        }
      }
      // 参数不存在，则返回-1
      return -1;
    }
  </script>
  <script src="./js/index.js"></script>
</body>

</html>